{"ast":null,"code":"\"use strict\";\n\nvar __makeTemplateObject = this && this.__makeTemplateObject || function (cooked, raw) {\n  if (Object.defineProperty) {\n    Object.defineProperty(cooked, \"raw\", {\n      value: raw\n    });\n  } else {\n    cooked.raw = raw;\n  }\n  return cooked;\n};\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (g && (g = 0, op[0] && (_ = 0)), _) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.PushToTalkButton = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar react_client_1 = require(\"@speechly/react-client\");\nvar pubsub_js_1 = __importDefault(require(\"pubsub-js\"));\nvar types_1 = require(\"../types\");\nvar __1 = require(\"..\");\nvar styled_components_1 = __importDefault(require(\"styled-components\"));\nvar PushToTalkButton = function (_a) {\n  var _b = _a.powerOn,\n    powerOn = _b === void 0 ? false : _b,\n    _c = _a.hide,\n    hide = _c === void 0 ? false : _c,\n    captureKey = _a.captureKey,\n    size = _a.size,\n    _d = _a.gradientStops,\n    gradientStops = _d === void 0 ? ['#15e8b5', '#4fa1f9'] : _d,\n    _e = _a.intro,\n    intro = _e === void 0 ? 'Hold to talk' : _e,\n    _f = _a.hint,\n    hint = _f === void 0 ? 'Hold to talk' : _f,\n    _g = _a.fontSize,\n    fontSize = _g === void 0 ? '100%' : _g,\n    showTime = _a.showTime,\n    _h = _a.textColor,\n    textColor = _h === void 0 ? '#ffffff' : _h,\n    backgroundColor = _a.backgroundColor,\n    placement = _a.placement,\n    voffset = _a.voffset,\n    _j = _a.tapToTalkTime,\n    tapToTalkTime = _j === void 0 ? 8000 : _j,\n    _k = _a.silenceToHangupTime,\n    silenceToHangupTime = _k === void 0 ? 1000 : _k;\n  var _l = (0, react_client_1.useSpeechContext)(),\n    client = _l.client,\n    clientState = _l.clientState,\n    microphoneState = _l.microphoneState,\n    attachMicrophone = _l.attachMicrophone,\n    start = _l.start,\n    stop = _l.stop,\n    segment = _l.segment;\n  var _m = (0, react_1.useState)(false),\n    loaded = _m[0],\n    setLoaded = _m[1];\n  var _o = (0, react_1.useState)(react_client_1.DecoderState.Disconnected),\n    icon = _o[0],\n    setIcon = _o[1];\n  var _p = (0, react_1.useState)(intro),\n    hintText = _p[0],\n    setHintText = _p[1];\n  var _q = (0, react_1.useState)(true),\n    showHint = _q[0],\n    setShowHint = _q[1];\n  var _r = (0, react_1.useState)(powerOn === true),\n    usePermissionPriming = _r[0],\n    setUsePermissionPriming = _r[1];\n  var buttonStateRef = (0, react_1.useRef)({\n    tapListenActive: false,\n    wasListening: false,\n    holdListenActive: false,\n    tapListenTimeout: null,\n    tangentPressPromise: null\n  });\n  var buttonRef = (0, react_1.useRef)();\n  var TAP_TRESHOLD_MS = 600;\n  var PERMISSION_PRE_GRANTED_TRESHOLD_MS = 1500;\n  // make stateRef always have the current count\n  // your \"fixed\" callbacks can refer to this object whenever\n  // they need the current value.  Note: the callbacks will not\n  // be reactive - they will not re-run the instant state changes,\n  // but they *will* see the current value whenever they do run\n  var clientStateRef = (0, react_1.useRef)(clientState);\n  var microphoneStateRef = (0, react_1.useRef)(microphoneState);\n  // Dynamic import of HTML custom element to play nice with Next.js SSR\n  (0, react_1.useEffect)(function () {\n    // eslint-disable-next-line @typescript-eslint/no-floating-promises\n    (function () {\n      return __awaiter(void 0, void 0, void 0, function () {\n        var import1, import2;\n        return __generator(this, function (_a) {\n          switch (_a.label) {\n            case 0:\n              import1 = Promise.resolve().then(function () {\n                return __importStar(require('@speechly/browser-ui/core/holdable-button'));\n              });\n              import2 = Promise.resolve().then(function () {\n                return __importStar(require('@speechly/browser-ui/core/call-out'));\n              });\n              return [4 /*yield*/, Promise.all([import1, import2])];\n            case 1:\n              _a.sent();\n              setLoaded(true);\n              return [2 /*return*/];\n          }\n        });\n      });\n    })();\n  }, []);\n  // Use browser API only after mount to play nice with Next.js SSR\n  (0, react_1.useEffect)(function () {\n    if (powerOn === 'auto') {\n      setUsePermissionPriming(localStorage.getItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */) === null);\n    }\n  }, [powerOn]);\n  (0, react_1.useEffect)(function () {\n    // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n    if (buttonRef === null || buttonRef === void 0 ? void 0 : buttonRef.current) {\n      var button = buttonRef.current;\n      button.onholdstart = tangentPressAction;\n      button.onholdend = tangentReleaseAction;\n    }\n  });\n  (0, react_1.useEffect)(function () {\n    clientStateRef.current = clientState;\n    microphoneStateRef.current = microphoneState;\n    // Change button appearance according to Speechly states\n    switch (microphoneState) {\n      case react_client_1.AudioSourceState.NoAudioConsent:\n      case react_client_1.AudioSourceState.NoBrowserSupport:\n        setIcon(microphoneState);\n        break;\n      default:\n        setIcon(clientState);\n        break;\n    }\n    if (clientState >= react_client_1.DecoderState.Connected && microphoneState === react_client_1.AudioSourceState.Started) {\n      setUsePermissionPriming(false);\n      // Set connect made\n      if (localStorage.getItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */) === null) {\n        localStorage.setItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */, String(Date.now()));\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [clientState, microphoneState]);\n  var tangentPressAction = function () {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!client) {\n          throw Error('No Speechly client (are you using Speechly in non-browser environment?)');\n        }\n        buttonStateRef.current.tangentPressPromise = function () {\n          return __awaiter(void 0, void 0, void 0, function () {\n            var initStartTime, err_1, err_2;\n            return __generator(this, function (_a) {\n              switch (_a.label) {\n                case 0:\n                  pubsub_js_1.default.publish(types_1.SpeechlyUiEvents.TangentPress, {\n                    state: clientStateRef.current\n                  });\n                  window.postMessage({\n                    type: 'holdstart',\n                    state: clientStateRef.current,\n                    audioSourceState: microphoneStateRef.current\n                  }, '*');\n                  setShowHint(false);\n                  if (!usePermissionPriming) return [3 /*break*/, 1];\n                  window.postMessage({\n                    type: \"speechlypoweron\" /* MessageType.speechlypoweron */\n                  }, '*');\n                  return [3 /*break*/, 11];\n                case 1:\n                  if (buttonStateRef.current.tapListenTimeout) {\n                    window.clearTimeout(buttonStateRef.current.tapListenTimeout);\n                    buttonStateRef.current.tapListenTimeout = null;\n                  }\n                  if (!(clientStateRef.current >= react_client_1.DecoderState.Connected && microphoneStateRef.current === react_client_1.AudioSourceState.Started)) return [3 /*break*/, 2];\n                  buttonStateRef.current.holdListenActive = true;\n                  return [3 /*break*/, 7];\n                case 2:\n                  initStartTime = Date.now();\n                  _a.label = 3;\n                case 3:\n                  _a.trys.push([3, 5,, 6]);\n                  return [4 /*yield*/, attachMicrophone()];\n                case 4:\n                  _a.sent();\n                  return [3 /*break*/, 6];\n                case 5:\n                  err_1 = _a.sent();\n                  console.error('Error initializing Speechly', err_1);\n                  return [3 /*break*/, 6];\n                case 6:\n                  // Long init time suggests permission dialog --> prevent listening start\n                  buttonStateRef.current.holdListenActive = Date.now() - initStartTime < PERMISSION_PRE_GRANTED_TRESHOLD_MS;\n                  _a.label = 7;\n                case 7:\n                  if (!buttonStateRef.current.holdListenActive) return [3 /*break*/, 11];\n                  buttonStateRef.current.wasListening = client.isActive();\n                  if (!!client.isActive()) return [3 /*break*/, 11];\n                  _a.label = 8;\n                case 8:\n                  _a.trys.push([8, 10,, 11]);\n                  return [4 /*yield*/, start()];\n                case 9:\n                  _a.sent();\n                  return [3 /*break*/, 11];\n                case 10:\n                  err_2 = _a.sent();\n                  console.error('Error while starting to record', err_2);\n                  return [3 /*break*/, 11];\n                case 11:\n                  return [2 /*return*/];\n              }\n            });\n          });\n        }();\n\n        return [2 /*return*/];\n      });\n    });\n  };\n\n  var tangentReleaseAction = function (event) {\n    return __awaiter(void 0, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // Ensure async tangentPress and Release are run in appropriate order\n            return [4 /*yield*/, buttonStateRef.current.tangentPressPromise];\n          case 1:\n            // Ensure async tangentPress and Release are run in appropriate order\n            _a.sent();\n            pubsub_js_1.default.publish(types_1.SpeechlyUiEvents.TangentRelease, {\n              state: clientStateRef.current,\n              timeMs: event.timeMs\n            });\n            window.postMessage({\n              type: 'holdend'\n            }, '*');\n            if (buttonStateRef.current.holdListenActive) {\n              buttonStateRef.current.holdListenActive = false;\n              if (event.timeMs < TAP_TRESHOLD_MS) {\n                if (tapToTalkTime === 0) {\n                  stopListening();\n                  setHintText(hint);\n                  setShowHint(true);\n                } else {\n                  // Tap: toggle listening on/off\n                  if (buttonStateRef.current.wasListening) {\n                    stopListening();\n                  } else {\n                    // schedule \"silence based stop\"\n                    setStopContextTimeout(tapToTalkTime);\n                  }\n                }\n              } else {\n                stopListening();\n              }\n            }\n            return [2 /*return*/];\n        }\n      });\n    });\n  };\n\n  var setStopContextTimeout = function (timeoutMs) {\n    buttonStateRef.current.tapListenActive = true;\n    if (buttonStateRef.current.tapListenTimeout) {\n      window.clearTimeout(buttonStateRef.current.tapListenTimeout);\n    }\n    buttonStateRef.current.tapListenTimeout = window.setTimeout(function () {\n      buttonStateRef.current.tapListenTimeout = null;\n      stopListening();\n    }, timeoutMs);\n  };\n  var stopListening = function () {\n    buttonStateRef.current.tapListenActive = false;\n    if (client === null || client === void 0 ? void 0 : client.isActive()) {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        stop();\n      } catch (err) {\n        console.error('Error while stopping recording', err);\n      }\n    }\n  };\n  /**\n   * Extend listening time if segment updates received\n   */\n  (0, react_1.useEffect)(function () {\n    if (segment) {\n      if (buttonStateRef.current.tapListenTimeout) {\n        setStopContextTimeout(silenceToHangupTime);\n      }\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [segment]);\n  if (!loaded) return null;\n  return react_1.default.createElement(MicButtonDiv, {\n    textColor: textColor,\n    fontSize: fontSize\n  }, placement === 'bottom' && react_1.default.createElement(__1.PushToTalkButtonContainer, {\n    size: size,\n    voffset: voffset\n  }, react_1.default.createElement(\"holdable-button\", {\n    ref: buttonRef,\n    poweron: powerOn,\n    capturekey: captureKey,\n    icon: icon,\n    size: size,\n    gradientstop1: gradientStops[0],\n    gradientstop2: gradientStops[1],\n    hide: hide ? 'true' : 'false'\n  }), react_1.default.createElement(\"call-out\", {\n    show: showHint && hintText !== '',\n    backgroundcolor: backgroundColor,\n    showtime: showTime\n  }, hintText)), placement !== 'bottom' && react_1.default.createElement(react_1.default.Fragment, null, react_1.default.createElement(\"holdable-button\", {\n    ref: buttonRef,\n    poweron: powerOn,\n    capturekey: captureKey,\n    icon: icon,\n    size: size,\n    gradientstop1: gradientStops[0],\n    gradientstop2: gradientStops[1],\n    hide: hide ? 'true' : 'false'\n  }), react_1.default.createElement(\"call-out\", {\n    show: showHint && hintText !== '',\n    backgroundcolor: backgroundColor,\n    showtime: showTime\n  }, hintText)));\n};\nexports.PushToTalkButton = PushToTalkButton;\nvar MicButtonDiv = styled_components_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  font-family: 'Saira Condensed', sans-serif;\\n  color: \", \";\\n  font-size: \", \";\\n  line-height: 120%;\\n  text-transform: uppercase;\\n\"], [\"\\n  font-family: 'Saira Condensed', sans-serif;\\n  color: \", \";\\n  font-size: \", \";\\n  line-height: 120%;\\n  text-transform: uppercase;\\n\"])), function (props) {\n  return props.textColor;\n}, function (props) {\n  return props.fontSize;\n});\nvar templateObject_1;","map":{"version":3,"sources":["../../src/components/PushToTalkButton.tsx"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["\"use strict\";\nvar __makeTemplateObject = (this && this.__makeTemplateObject) || function (cooked, raw) {\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\n    return cooked;\n};\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.PushToTalkButton = void 0;\nvar react_1 = __importStar(require(\"react\"));\nvar react_client_1 = require(\"@speechly/react-client\");\nvar pubsub_js_1 = __importDefault(require(\"pubsub-js\"));\nvar types_1 = require(\"../types\");\nvar __1 = require(\"..\");\nvar styled_components_1 = __importDefault(require(\"styled-components\"));\nvar PushToTalkButton = function (_a) {\n    var _b = _a.powerOn, powerOn = _b === void 0 ? false : _b, _c = _a.hide, hide = _c === void 0 ? false : _c, captureKey = _a.captureKey, size = _a.size, _d = _a.gradientStops, gradientStops = _d === void 0 ? ['#15e8b5', '#4fa1f9'] : _d, _e = _a.intro, intro = _e === void 0 ? 'Hold to talk' : _e, _f = _a.hint, hint = _f === void 0 ? 'Hold to talk' : _f, _g = _a.fontSize, fontSize = _g === void 0 ? '100%' : _g, showTime = _a.showTime, _h = _a.textColor, textColor = _h === void 0 ? '#ffffff' : _h, backgroundColor = _a.backgroundColor, placement = _a.placement, voffset = _a.voffset, _j = _a.tapToTalkTime, tapToTalkTime = _j === void 0 ? 8000 : _j, _k = _a.silenceToHangupTime, silenceToHangupTime = _k === void 0 ? 1000 : _k;\n    var _l = (0, react_client_1.useSpeechContext)(), client = _l.client, clientState = _l.clientState, microphoneState = _l.microphoneState, attachMicrophone = _l.attachMicrophone, start = _l.start, stop = _l.stop, segment = _l.segment;\n    var _m = (0, react_1.useState)(false), loaded = _m[0], setLoaded = _m[1];\n    var _o = (0, react_1.useState)(react_client_1.DecoderState.Disconnected), icon = _o[0], setIcon = _o[1];\n    var _p = (0, react_1.useState)(intro), hintText = _p[0], setHintText = _p[1];\n    var _q = (0, react_1.useState)(true), showHint = _q[0], setShowHint = _q[1];\n    var _r = (0, react_1.useState)(powerOn === true), usePermissionPriming = _r[0], setUsePermissionPriming = _r[1];\n    var buttonStateRef = (0, react_1.useRef)({\n        tapListenActive: false,\n        wasListening: false,\n        holdListenActive: false,\n        tapListenTimeout: null,\n        tangentPressPromise: null,\n    });\n    var buttonRef = (0, react_1.useRef)();\n    var TAP_TRESHOLD_MS = 600;\n    var PERMISSION_PRE_GRANTED_TRESHOLD_MS = 1500;\n    // make stateRef always have the current count\n    // your \"fixed\" callbacks can refer to this object whenever\n    // they need the current value.  Note: the callbacks will not\n    // be reactive - they will not re-run the instant state changes,\n    // but they *will* see the current value whenever they do run\n    var clientStateRef = (0, react_1.useRef)(clientState);\n    var microphoneStateRef = (0, react_1.useRef)(microphoneState);\n    // Dynamic import of HTML custom element to play nice with Next.js SSR\n    (0, react_1.useEffect)(function () {\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n        (function () { return __awaiter(void 0, void 0, void 0, function () {\n            var import1, import2;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        import1 = Promise.resolve().then(function () { return __importStar(require('@speechly/browser-ui/core/holdable-button')); });\n                        import2 = Promise.resolve().then(function () { return __importStar(require('@speechly/browser-ui/core/call-out')); });\n                        return [4 /*yield*/, Promise.all([import1, import2])];\n                    case 1:\n                        _a.sent();\n                        setLoaded(true);\n                        return [2 /*return*/];\n                }\n            });\n        }); })();\n    }, []);\n    // Use browser API only after mount to play nice with Next.js SSR\n    (0, react_1.useEffect)(function () {\n        if (powerOn === 'auto') {\n            setUsePermissionPriming(localStorage.getItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */) === null);\n        }\n    }, [powerOn]);\n    (0, react_1.useEffect)(function () {\n        // eslint-disable-next-line @typescript-eslint/strict-boolean-expressions\n        if (buttonRef === null || buttonRef === void 0 ? void 0 : buttonRef.current) {\n            var button = buttonRef.current;\n            button.onholdstart = tangentPressAction;\n            button.onholdend = tangentReleaseAction;\n        }\n    });\n    (0, react_1.useEffect)(function () {\n        clientStateRef.current = clientState;\n        microphoneStateRef.current = microphoneState;\n        // Change button appearance according to Speechly states\n        switch (microphoneState) {\n            case react_client_1.AudioSourceState.NoAudioConsent:\n            case react_client_1.AudioSourceState.NoBrowserSupport:\n                setIcon(microphoneState);\n                break;\n            default:\n                setIcon(clientState);\n                break;\n        }\n        if (clientState >= react_client_1.DecoderState.Connected && microphoneState === react_client_1.AudioSourceState.Started) {\n            setUsePermissionPriming(false);\n            // Set connect made\n            if (localStorage.getItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */) === null) {\n                localStorage.setItem(\"SpeechlyFirstConnect\" /* LocalStorageKeys.SpeechlyFirstConnect */, String(Date.now()));\n            }\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [clientState, microphoneState]);\n    var tangentPressAction = function () { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (!client) {\n                throw Error('No Speechly client (are you using Speechly in non-browser environment?)');\n            }\n            buttonStateRef.current.tangentPressPromise = (function () { return __awaiter(void 0, void 0, void 0, function () {\n                var initStartTime, err_1, err_2;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            pubsub_js_1.default.publish(types_1.SpeechlyUiEvents.TangentPress, { state: clientStateRef.current });\n                            window.postMessage({ type: 'holdstart', state: clientStateRef.current, audioSourceState: microphoneStateRef.current }, '*');\n                            setShowHint(false);\n                            if (!usePermissionPriming) return [3 /*break*/, 1];\n                            window.postMessage({\n                                type: \"speechlypoweron\" /* MessageType.speechlypoweron */,\n                            }, '*');\n                            return [3 /*break*/, 11];\n                        case 1:\n                            if (buttonStateRef.current.tapListenTimeout) {\n                                window.clearTimeout(buttonStateRef.current.tapListenTimeout);\n                                buttonStateRef.current.tapListenTimeout = null;\n                            }\n                            if (!(clientStateRef.current >= react_client_1.DecoderState.Connected && microphoneStateRef.current === react_client_1.AudioSourceState.Started)) return [3 /*break*/, 2];\n                            buttonStateRef.current.holdListenActive = true;\n                            return [3 /*break*/, 7];\n                        case 2:\n                            initStartTime = Date.now();\n                            _a.label = 3;\n                        case 3:\n                            _a.trys.push([3, 5, , 6]);\n                            return [4 /*yield*/, attachMicrophone()];\n                        case 4:\n                            _a.sent();\n                            return [3 /*break*/, 6];\n                        case 5:\n                            err_1 = _a.sent();\n                            console.error('Error initializing Speechly', err_1);\n                            return [3 /*break*/, 6];\n                        case 6:\n                            // Long init time suggests permission dialog --> prevent listening start\n                            buttonStateRef.current.holdListenActive = Date.now() - initStartTime < PERMISSION_PRE_GRANTED_TRESHOLD_MS;\n                            _a.label = 7;\n                        case 7:\n                            if (!buttonStateRef.current.holdListenActive) return [3 /*break*/, 11];\n                            buttonStateRef.current.wasListening = client.isActive();\n                            if (!!client.isActive()) return [3 /*break*/, 11];\n                            _a.label = 8;\n                        case 8:\n                            _a.trys.push([8, 10, , 11]);\n                            return [4 /*yield*/, start()];\n                        case 9:\n                            _a.sent();\n                            return [3 /*break*/, 11];\n                        case 10:\n                            err_2 = _a.sent();\n                            console.error('Error while starting to record', err_2);\n                            return [3 /*break*/, 11];\n                        case 11: return [2 /*return*/];\n                    }\n                });\n            }); })();\n            return [2 /*return*/];\n        });\n    }); };\n    var tangentReleaseAction = function (event) { return __awaiter(void 0, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: \n                // Ensure async tangentPress and Release are run in appropriate order\n                return [4 /*yield*/, buttonStateRef.current.tangentPressPromise];\n                case 1:\n                    // Ensure async tangentPress and Release are run in appropriate order\n                    _a.sent();\n                    pubsub_js_1.default.publish(types_1.SpeechlyUiEvents.TangentRelease, { state: clientStateRef.current, timeMs: event.timeMs });\n                    window.postMessage({ type: 'holdend' }, '*');\n                    if (buttonStateRef.current.holdListenActive) {\n                        buttonStateRef.current.holdListenActive = false;\n                        if (event.timeMs < TAP_TRESHOLD_MS) {\n                            if (tapToTalkTime === 0) {\n                                stopListening();\n                                setHintText(hint);\n                                setShowHint(true);\n                            }\n                            else {\n                                // Tap: toggle listening on/off\n                                if (buttonStateRef.current.wasListening) {\n                                    stopListening();\n                                }\n                                else {\n                                    // schedule \"silence based stop\"\n                                    setStopContextTimeout(tapToTalkTime);\n                                }\n                            }\n                        }\n                        else {\n                            stopListening();\n                        }\n                    }\n                    return [2 /*return*/];\n            }\n        });\n    }); };\n    var setStopContextTimeout = function (timeoutMs) {\n        buttonStateRef.current.tapListenActive = true;\n        if (buttonStateRef.current.tapListenTimeout) {\n            window.clearTimeout(buttonStateRef.current.tapListenTimeout);\n        }\n        buttonStateRef.current.tapListenTimeout = window.setTimeout(function () {\n            buttonStateRef.current.tapListenTimeout = null;\n            stopListening();\n        }, timeoutMs);\n    };\n    var stopListening = function () {\n        buttonStateRef.current.tapListenActive = false;\n        if (client === null || client === void 0 ? void 0 : client.isActive()) {\n            try {\n                // eslint-disable-next-line @typescript-eslint/no-floating-promises\n                stop();\n            }\n            catch (err) {\n                console.error('Error while stopping recording', err);\n            }\n        }\n    };\n    /**\n     * Extend listening time if segment updates received\n     */\n    (0, react_1.useEffect)(function () {\n        if (segment) {\n            if (buttonStateRef.current.tapListenTimeout) {\n                setStopContextTimeout(silenceToHangupTime);\n            }\n        }\n        // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, [segment]);\n    if (!loaded)\n        return null;\n    return (react_1.default.createElement(MicButtonDiv, { textColor: textColor, fontSize: fontSize },\n        (placement === 'bottom') && (react_1.default.createElement(__1.PushToTalkButtonContainer, { size: size, voffset: voffset },\n            react_1.default.createElement(\"holdable-button\", { ref: buttonRef, poweron: powerOn, capturekey: captureKey, icon: icon, size: size, gradientstop1: gradientStops[0], gradientstop2: gradientStops[1], hide: hide ? 'true' : 'false' }),\n            react_1.default.createElement(\"call-out\", { show: showHint && hintText !== '', backgroundcolor: backgroundColor, showtime: showTime }, hintText))),\n        (placement !== 'bottom') && (react_1.default.createElement(react_1.default.Fragment, null,\n            react_1.default.createElement(\"holdable-button\", { ref: buttonRef, poweron: powerOn, capturekey: captureKey, icon: icon, size: size, gradientstop1: gradientStops[0], gradientstop2: gradientStops[1], hide: hide ? 'true' : 'false' }),\n            react_1.default.createElement(\"call-out\", { show: showHint && hintText !== '', backgroundcolor: backgroundColor, showtime: showTime }, hintText)))));\n};\nexports.PushToTalkButton = PushToTalkButton;\nvar MicButtonDiv = styled_components_1.default.div(templateObject_1 || (templateObject_1 = __makeTemplateObject([\"\\n  font-family: 'Saira Condensed', sans-serif;\\n  color: \", \";\\n  font-size: \", \";\\n  line-height: 120%;\\n  text-transform: uppercase;\\n\"], [\"\\n  font-family: 'Saira Condensed', sans-serif;\\n  color: \", \";\\n  font-size: \", \";\\n  line-height: 120%;\\n  text-transform: uppercase;\\n\"])), function (props) { return props.textColor; }, function (props) { return props.fontSize; });\nvar templateObject_1;\n//# sourceMappingURL=PushToTalkButton.js.map"]},"metadata":{},"sourceType":"script"}